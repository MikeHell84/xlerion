<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- DESREGISTRAR SERVICE WORKER SOLO EN DESARROLLO O SIMPLE BROWSER -->
  <script>
    // Detecta entorno de desarrollo o VS Code Simple Browser
    const isDev = location.hostname === 'localhost' || location.hostname === '127.0.0.1';
    const isSimpleBrowser = navigator.userAgent.includes('VSCode') || navigator.userAgent.includes('SimpleBrowser');
    if (isDev || isSimpleBrowser) {
      // Solo desregistra en desarrollo o Simple Browser
      if ('serviceWorker' in navigator) {
        navigator.serviceWorker.getRegistrations().then(registrations => {
          registrations.forEach(reg => reg.unregister());
        });
      }
      if ('caches' in window) {
        caches.keys().then(names => {
          names.forEach(name => caches.delete(name));
        });
      }
    }
    // En producción, el service worker permanece activo
  </script>

  <!-- SEO Meta Tags -->
  <meta name="description"
    content="Xlerion Stories - Crea, gestiona y publica tus mundos e historias interactivas. Sistema de gestión de contenido para escritores y creadores de mundos narrativos.">
  <meta name="keywords"
    content="creación de historias, worldbuilding, gestión de contenido, escritura creativa, narrativa interactiva, Total Darkness, Xlerion, CMS para escritores, gestión de personajes, gestión de capítulos">
  <meta name="author" content="Xlerion">
  <meta name="robots" content="index, follow">
  <link rel="canonical" href="https://xlerion.com/total-darkness/">

  <!-- Open Graph / Facebook -->
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://xlerion.com/total-darkness/">
  <meta property="og:title" content="Xlerion Stories - Crea tus Mundos e Historias Interactivas">
  <meta property="og:description"
    content="Sistema completo para crear, gestionar y publicar tus historias y mundos narrativos. Gestiona capítulos, personajes, lugares y objetos con IA integrada.">
  <meta property="og:image" content="https://xlerion.com/total-darkness/images/og-image.png">
  <meta property="og:locale" content="es_ES">
  <meta property="og:locale:alternate" content="en_US">
  <meta property="og:site_name" content="Xlerion Stories">

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:url" content="https://xlerion.com/total-darkness/">
  <meta name="twitter:title" content="Xlerion Stories - Crea tus Mundos e Historias">
  <meta name="twitter:description"
    content="Sistema completo para crear, gestionar y publicar tus historias y mundos narrativos.">
  <meta name="twitter:image" content="https://xlerion.com/total-darkness/images/twitter-card.png">

  <!-- Metadatos PWA -->
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#1A1A1A">
  <!-- Compatibilidad con iOS -->
  <link rel="apple-touch-icon" href="icons/icon-192x192.png">
  <link rel="apple-touch-icon" href="images/favicon.png">
  <link rel="apple-touch-icon" sizes="192x192" href="icons/icon-192x192.png">
  <link rel="apple-touch-icon" sizes="512x512" href="icons/icon-512x512.png">
  <link rel="mask-icon" href="../LogoX.svg" color="#00e9fa">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Story Creator">
  <title>Xlerion Stories - Crea y Gestiona tus Mundos e Historias Interactivas</title>

  <!-- Structured Data JSON-LD -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebApplication",
    "name": "Xlerion Stories",
    "applicationCategory": "CreativeWorkSoftware",
    "description": "Sistema de gestión de contenido para crear, gestionar y publicar historias interactivas y mundos narrativos.",
    "url": "https://xlerion.com/total-darkness/",
    "author": {
      "@type": "Organization",
      "name": "Xlerion",
      "url": "https://xlerion.com"
    },
    "offers": {
      "@type": "Offer",
      "price": "0",
      "priceCurrency": "USD"
    },
    "featureList": [
      "Gestión de capítulos y escenas",
      "Gestión de personajes con fichas detalladas",
      "Gestión de lugares y mapas",
      "Gestión de objetos y elementos",
      "Generación de imágenes con IA",
      "Mapas mentales interactivos",
      "Exportación a PDF, HTML y KDP",
      "Sistema de calificaciones y comentarios",
      "Soporte multiidioma (Español/Inglés)"
    ],
    "inLanguage": ["es", "en"],
    "browserRequirements": "Requires JavaScript. Requires HTML5."
  }
  </script>

  <!-- Tailwind (Local) -->
  <script src="vendor/tailwind.js"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#00e9fa',
            secondary: '#333436',
            background: '#000000'
          },
          fontFamily: {
            sans: ['Inter', 'sans-serif'],
            mono: ['Roboto Mono', 'monospace']
          }
        }
      }
    }
  </script>

  <!-- Iconos y fuentes (Xlerion Brand) -->
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&family=Roboto+Mono:ital,wght@0,400;0,700;1,400&display=swap"
    rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
  <link rel="icon" href="images/favicon.ico" type="image/x-icon">
  <link rel="stylesheet" href="styles.css">

  <!-- Librerías para el Mapa Mental -->
  <!-- Attempt to load local vendor files first (recommended for production). If they are missing,
       the page will fall back to the CDN. Place the real vis-network files in "vendor/". -->
  <script>
      (function () {
        // Load CSS with fallback to CDN if local missing
        var css = document.createElement('link');
        css.rel = 'stylesheet';
        css.href = 'vendor/vis-network.min.css';
        css.onerror = function () {
          var cdn = document.createElement('link');
          cdn.rel = 'stylesheet';
          cdn.href = 'https://unpkg.com/vis-network/styles/vis-network.min.css';
          document.head.appendChild(cdn);
        };
        document.head.appendChild(css);

        // Load JS with fallback to CDN if local missing
        var script = document.createElement('script');
        script.src = 'vendor/vis-network.min.js';
        script.onload = function () { console.log('vis-network: loaded local vendor file'); };
        script.onerror = function () {
          var cdnScript = document.createElement('script');
          cdnScript.src = 'https://unpkg.com/vis-network/standalone/umd/vis-network.min.js';
          document.head.appendChild(cdnScript);
        };
        document.head.appendChild(script);
      })();
  </script>

  <!-- IndexedDB wrapper library (Local) -->
  <script src="vendor/idb.js"></script>

  <!-- jsPDF para exportar a PDF (Local) -->
  <script src="vendor/jspdf.js"></script>
  <script src="vendor/jspdf-autotable.js"></script>

  <!-- JSZip y FileSaver para exportar a Web (ZIP) (Local) -->
  <script src="vendor/jszip.js"></script>
  <script src="vendor/filesaver.js"></script>

  <!-- Chart.js para gráficos (Local) -->
  <script src="vendor/chart.js"></script>

  <!-- Estilos personalizados (Xlerion Brand) -->
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&family=Roboto+Mono:ital,wght@0,400;0,700;1,400&display=swap');

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html,
    body,
    #root {
      height: 100%;
      background-color: #000000;
      color: #FFFFFF;
      font-family: 'Inter', sans-serif;
    }

    h1,
    h2,
    h3,
    h4,
    h5,
    h6 {
      font-family: 'Roboto Mono', monospace;
      font-style: italic;
      text-transform: uppercase;
      letter-spacing: -0.05em;
      font-weight: 800;
    }

    h1 {
      font-size: 3rem;
    }

    h2 {
      font-size: 2.25rem;
    }

    h3 {
      font-size: 1.5rem;
    }

    /* ===== BOTONES XLERION ===== */
    .xl-btn-primary {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
      padding: 12px 40px;
      background-color: #00e9fa;
      color: #000000;
      font-weight: 800;
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 2px;
      border: 2px solid #00e9fa;
      border-radius: 4px;
      cursor: pointer;
      transition: all 0.3s ease;
      text-decoration: none;
    }

    .xl-btn-primary:hover {
      background-color: transparent;
      color: #00e9fa;
      box-shadow: 0 0 30px rgba(0, 233, 250, 0.4), inset 0 0 20px rgba(0, 233, 250, 0.1);
    }

    .xl-btn-primary:active {
      transform: scale(0.95);
    }

    .xl-btn-secondary {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 12px 32px;
      background-color: #333436;
      color: #FFFFFF;
      font-weight: 700;
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 2px;
      border: 2px solid #333436;
      border-radius: 4px;
      cursor: pointer;
      transition: all 0.3s ease;
      text-decoration: none;
    }

    .xl-btn-secondary:hover {
      border-color: #00e9fa;
      color: #00e9fa;
      background-color: rgba(51, 52, 54, 0.5);
    }

    /* ===== TARJETAS ===== */
    .xl-card {
      position: relative;
      background-color: #000000;
      border: 1px solid rgba(255, 255, 255, 0.1);
      padding: 32px;
      border-radius: 4px;
      backdrop-filter: blur(10px);
      transition: all 0.3s ease;
      overflow: hidden;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
    }

    .xl-card:hover {
      border-color: rgba(0, 233, 250, 0.5);
      box-shadow: 0 0 20px rgba(0, 233, 250, 0.2), inset 0 0 15px rgba(0, 233, 250, 0.05);
    }

    .xl-card-header {
      display: flex;
      align-items: center;
      gap: 16px;
      margin-bottom: 16px;
      position: relative;
      z-index: 10;
    }

    .xl-card-title {
      font-family: 'Roboto Mono', monospace;
      font-size: 18px;
      font-weight: 700;
      color: #FFFFFF;
      text-transform: uppercase;
      font-style: italic;
      letter-spacing: 1px;
    }

    .xl-card-body {
      color: #B0B0B0;
      font-size: 14px;
      line-height: 1.6;
      position: relative;
      z-index: 10;
    }

    /* ===== INPUTS ===== */
    .xl-input {
      width: 100%;
      background-color: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 4px;
      padding: 16px;
      color: #FFFFFF;
      font-size: 14px;
      transition: all 0.3s ease;
      font-family: 'Inter', sans-serif;
    }

    .xl-input:focus {
      outline: none;
      border-color: #00e9fa;
      box-shadow: 0 0 20px rgba(0, 233, 250, 0.3), inset 0 0 10px rgba(0, 233, 250, 0.05);
      background-color: rgba(255, 255, 255, 0.08);
    }

    .xl-input::placeholder {
      color: #666666;
    }

    overflow: hidden;
    padding: 1rem;
    box-sizing: border-box;
    }

    .modal-header {
      flex: 0 0 auto;
    }

    .modal-body {
      flex: 1 1 auto;
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
      padding-right: .5rem;
    }

    .modal-footer {
      flex: 0 0 auto;
      margin-top: .75rem;
    }

    #detailsDescription {
      white-space: pre-wrap;
      word-break: break-word;
      line-height: 1.5;
      color: #D1D5DB;
    }

    #detailsImageContainer {
      max-height: 36vh;
      overflow: hidden;
      border-radius: 8px;
      margin-bottom: .75rem;
    }

    #detailsImage {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    /* Scrollbar personalizado */
    .modal-body::-webkit-scrollbar,
    #detailsDescription::-webkit-scrollbar {
      width: 10px;
    }

    .modal-body::-webkit-scrollbar-thumb,
    #detailsDescription::-webkit-scrollbar-thumb {
      background: rgba(99, 102, 241, 0.2);
      border-radius: 10px;
    }

    /* ===== ESTILOS PARA PESTAÑAS ACTIVAS ===== */
    .tab-button.active {
      color: #00e9fa !important;
      border-bottom-color: #00e9fa !important;
      border-right-color: #00e9fa !important;
      box-shadow: 0 0 15px rgba(0, 233, 250, 0.2) !important;
    }

    .tab-button.active:hover {
      color: #00e9fa !important;
    }

    /* ===== FIX: Panel de manipulación de Vis.js ===== */
    #mindMapContainer div.vis-manipulation {
      /* Posicionamiento en la parte inferior central */
      position: absolute !important;
      bottom: 20px !important;
      left: 150% !important;
      transform: translateX(-50%) !important;
      top: auto !important;
      /* Anular el 'top' por defecto */
      width: auto !important;
      /* Ancho automático basado en el contenido */

      /* Estilo del contenedor */
      background: #1A1A1A !important;
      /* Fondo muy oscuro, consistente con la UI */
      border: 1px solid #444 !important;
      border-radius: 12px !important;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5) !important;
      padding: 8px !important;

      /* Layout horizontal */
      display: flex !important;
      flex-direction: row !important;
      gap: 8px !important;
    }

    /* Ocultar el texto de la etiqueta para un look más limpio, los tooltips seguirán funcionando */
    #mindMapContainer div.vis-manipulation .vis-label {
      display: none !important;
    }

    /* Estilo de los botones individuales */
    #mindMapContainer div.vis-manipulation .vis-button {
      background-color: #242424 !important;
      border: 1px solid #444 !important;
      border-radius: 8px !important;
      width: 44px !important;
      /* Tamaño fijo para botones cuadrados */
      height: 44px !important;
      transition: background-color 0.2s, border-color 0.2s;
      background-position: center center !important;
      /* Centrar el icono */
    }

    #mindMapContainer div.vis-manipulation .vis-button:hover {
      background-color: #333 !important;
      border-color: #00e9fa !important;
      /* Resaltar con color de acento al pasar el ratón */
    }

    /* Estilo para el botón seleccionado/activo */
    #mindMapContainer div.vis-manipulation .vis-button.vis-selected {
      background-color: #00e9fa !important;
      /* Color de acento para el botón seleccionado */
      border-color: #00d4e0 !important;
    }

    /* Estilo de la línea separadora (ahora vertical) */
    #mindMapContainer div.vis-manipulation .vis-separator-line {
      width: 1px !important;
      height: 30px !important;
      /* Altura para la línea vertical */
      background: #444 !important;
      margin: auto 4px !important;
      /* Centrar verticalmente y dar espacio horizontal */
    }

    /* Estilo para el sub-panel de edición (cuando se edita un nodo/enlace) */
    #mindMapContainer div.vis-edit-mode {
      background: #1A1A1A !important;
      border: 1px solid #444 !important;
      border-radius: 12px !important;
      padding: 12px !important;
    }

    /* 
     * FIX: Contraste y estética para el panel de configuración de físicas de Vis.js.
     * NOTA: Vis.js añade este panel al 'body', no al contenedor del mapa, 
     * por lo que los selectores no deben estar anidados dentro de #mindMapContainer.
     */
    div.vis-configuration-wrapper {
      background: #1A1A1A !important;
      border: 1px solid #444 !important;
      border-radius: 12px !important;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4) !important;
      color: #e70000 !important;
      /* --- Lógica de Centrado y Tamaño --- */
      left: calc(50% + 140px) !important;
      /* Centra en el área de contenido (140px = 280px sidebar / 2) */
      bottom: 80px !important;
      /* Lo mantiene sobre la barra de herramientas inferior */

      width: 90% !important;
      /* Usar porcentaje para adaptabilidad */
      max-width: 500px !important;
      /* Ancho máximo ajustado para no ser tan grande */
      min-width: 320px !important;
      /* Asegurar un ancho mínimo legible */
      z-index: 1100 !important;
      /* Asegura que esté por encima de otros elementos */
    }

    /* Asegura que el contenedor interno no tenga su propio fondo blanco */
    div.vis-configuration {
      background: transparent !important;
      color: inherit !important;
    }

    div.vis-configuration .vis-config-header {
      color: #00e9fa !important;
      font-weight: bold;
      border-bottom: 1px solid #444;
    }

    div.vis-configuration .vis-config-item .vis-config-label {
      color: #00f7ff !important;
    }

    /* Asegura que el texto del valor del slider (ej: "0.3") sea visible */
    div.vis-configuration .vis-config-item .vis-config-field {
      color: #000000 !important;
    }

    div.vis-configuration .vis-config-item input[type=range] {
      -webkit-appearance: none;
      appearance: none;
      width: 100%;
      height: 8px;
      background: #444;
      border-radius: 5px;
      outline: none;
      transition: background 0.2s;
    }

    div.vis-configuration .vis-config-item input[type=range]:hover {
      background: #555;
    }

    div.vis-configuration .vis-config-item input[type=range]::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 18px;
      height: 18px;
      background: #00e9fa;
      cursor: pointer;
      border-radius: 50%;
    }

    div.vis-configuration .vis-config-item input[type=range]::-moz-range-thumb {
      width: 18px;
      height: 18px;
      background: #00e9fa;
      cursor: pointer;
      border-radius: 50%;
    }

    /* Botón de cierre (X) */
    div.vis-configuration .vis-close {
      background: #242424 !important;
      border-radius: 50% !important;
      width: 28px !important;
      height: 28px !important;
      top: 10px !important;
      right: 10px !important;
      transition: background-color 0.2s, transform 0.2s;
    }

    div.vis-configuration .vis-close:hover {
      background: #00e9fa !important;
      transform: rotate(90deg);
    }

    /* Estilos para la tarjeta de comentario en el panel de gestión */
    .comment-card {
      background-color: #242424;
      border-left: 4px solid #00e9fa;
    }

    /* Fondo con parallax y blur */
    #parallax-bg {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-image: url('images/background.png');
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      filter: blur(8px) brightness(0.5);
      z-index: 0;
      pointer-events: none;
    }

    body {
      position: relative;
      z-index: 1;
      background: transparent;
    }

    #login-screen {
      background: rgba(0, 0, 0, 0.3);
      backdrop-filter: blur(4px);
      -webkit-backdrop-filter: blur(4px);
    }
  </style>
</head>

<body class="h-screen overflow-hidden">

  <!-- ========== FONDO CON PARALLAX ========== -->
  <div id="parallax-bg"></div>

  <!-- ========== PANTALLA DE LOGIN ========== -->
  <div id="login-screen" class="fixed inset-0 bg-black flex items-center justify-center z-[1001]">
    <div class="w-full max-w-md p-8 space-y-8 bg-black rounded-2xl shadow-lg border border-primary/20">
      <div class="flex justify-center mb-6">
        <img src="images/total-darkness-logo.png" alt="Total Darkness" class="h-20 object-contain" />
      </div>
      <div>
        <h2 class="mt-6 text-center text-3xl font-extrabold text-white">
          Iniciar Sesión
        </h2>
        <p class="mt-2 text-center text-sm text-gray-400">
          Acceso al Creador de Historias
        </p>
      </div>
      <form id="login-form" class="mt-8 space-y-6">
        <div class="rounded-md shadow-sm -space-y-px">
          <div>
            <input id="email" name="email" type="email" autocomplete="email" required
              class="appearance-none rounded-none relative block w-full px-3 py-3 border border-white/10 bg-white/5 text-white placeholder-gray-400 focus:outline-none focus:ring-primary focus:border-primary focus:z-10 sm:text-sm rounded-t-md"
              placeholder="Correo Electrónico">
          </div>
          <div>
            <input id="password" name="password" type="password" autocomplete="current-password" required
              class="appearance-none rounded-none relative block w-full px-3 py-3 border border-white/10 bg-white/5 text-white placeholder-gray-400 focus:outline-none focus:ring-primary focus:border-primary focus:z-10 sm:text-sm rounded-b-md"
              placeholder="Contraseña">
          </div>
        </div>
        <p id="login-error-message" class="text-red-400 text-sm text-center hidden"></p>
        <div class="flex flex-col space-y-4">
          <button id="login-button" type="submit"
            class="group relative w-full flex justify-center py-3 px-4 border border-primary text-sm font-medium rounded-md text-black bg-primary hover:bg-transparent hover:text-primary focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary focus:ring-offset-black">
            Entrar
          </button>
          <button id="register-button" type="button"
            class="group relative w-full flex justify-center py-3 px-4 border border-primary text-sm font-medium rounded-md text-primary bg-transparent hover:bg-primary hover:text-black focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary focus:ring-offset-black hidden">
            Registrarse
          </button>
          <a href="recovery.html"
            class="group relative w-full flex justify-center py-2 px-4 text-sm font-medium rounded-md text-gray-400 bg-transparent hover:text-primary focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary focus:ring-offset-black transition-colors">
            ¿Olvidaste tu contraseña?
          </a>
        </div>
      </form>
      <div class="relative flex py-3 items-center hidden">
        <div class="flex-grow border-t border-gray-600"></div>
        <span class="flex-shrink mx-4 text-gray-400 text-sm">O continuar con</span>
        <div class="flex-grow border-t border-gray-600"></div>
      </div>
      <div class="hidden">
        <button id="google-signin-button" type="button"
          class="w-full inline-flex justify-center py-3 px-4 border border-gray-600 rounded-md shadow-sm bg-gray-700 text-sm font-medium text-white hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[#00e9fa] focus:ring-offset-gray-800">
          <svg class="w-5 h-5 mr-2" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48"
            width="48px" height="48px">
            <path fill="#FFC107"
              d="M43.611,20.083H42V20H24v8h11.303c-1.649,4.657-6.08,8-11.303,8c-6.627,0-12-5.373-12-12c0-6.627,5.373-12,12-12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C12.955,4,4,12.955,4,24c0,11.045,8.955,20,20,20c11.045,0,20-8.955,20-20C44,22.659,43.862,21.35,43.611,20.083z" />
            <path fill="#FF3D00"
              d="M6.306,14.691l6.571,4.819C14.655,15.108,18.961,12,24,12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C16.318,4,9.656,8.337,6.306,14.691z" />
            <path fill="#4CAF50"
              d="M24,44c5.166,0,9.86-1.977,13.409-5.192l-6.19-5.238C29.211,35.091,26.715,36,24,36c-5.202,0-9.619-3.317-11.283-7.946l-6.522,5.025C9.505,39.556,16.227,44,24,44z" />
            <path fill="#1976D2"
              d="M43.611,20.083H42V20H24v8h11.303c-0.792,2.237-2.231,4.166-4.087,5.574l6.19,5.238C42.021,35.596,44,30.138,44,24C44,22.659,43.862,21.35,43.611,20.083z" />

          </svg>
          <span>Iniciar sesión con Google</span>
        </button>
      </div>
    </div>
  </div>

  <!-- ========== CONTENIDO PRINCIPAL DE LA APP (Inicialmente oculto) ========== -->
  <div id="app-container" class="flex h-screen overflow-hidden hidden">

    <!-- Input oculto para la importación de archivos JSON -->
    <input type="file" id="importJsonInput" class="hidden" accept=".json">

    <!-- Botón para mostrar/ocultar la barra lateral en móviles -->
    <button id="sidebar-toggle" title="Mostrar/Ocultar menú"
      class="md:hidden fixed top-4 left-4 z-50 p-2 bg-[#00e9fa] text-black rounded-md shadow-lg">
      <i class="fas fa-bars text-xl"></i>
    </button>

    <!-- Sidebar -->
    <aside id="sidebar"
      class="sidebar p-6 space-y-4 md:relative md:translate-x-0 fixed h-full -translate-x-full transition-transform duration-300 ease-in-out z-40">
      <div class="flex justify-center mb-4">
        <img src="images/total-darkness-logo.png" alt="Total Darkness" class="w-full max-w-xs object-contain" />
      </div>
      <!-- Botón de Cerrar Sesión -->
      <div class="absolute top-4 right-4 flex gap-2">
        <button id="admin-panel-button" title="Gestión de Administradores"
          class="text-gray-400 hover:text-primary transition-colors text-xl">
          <i class="fas fa-users-cog"></i>
        </button>
        <button id="logout-button" title="Cerrar Sesión"
          class="text-gray-400 hover:text-red-500 transition-colors text-xl">
          <i class="fas fa-sign-out-alt"></i>
        </button>
      </div>
      <button id="btnNuevoProyecto" class="btn btn-primary w-full"><i class="fas fa-plus-circle mr-2"></i> Nuevo
        Proyecto</button>
      <div class="flex-grow overflow-y-auto pr-2">
        <ul id="listaProyectos" class="space-y-3"></ul>
      </div>
      <div class="space-y-2 pt-4 border-t border-gray-700">
        <!-- Navegación a Historia -->
        <a href="/total-darkness/historia.html" class="btn btn-secondary w-full flex items-center justify-center"><i
            class="fas fa-scroll mr-2"></i> Ver
          Historia</a>
        <!-- Botón de Vista Pública (ahora ocupa todo el ancho y está separado) -->
        <a id="btnVerPublico" href="#" target="_blank"
          class="btn btn-secondary w-full hidden flex items-center justify-center"><i class="fas fa-eye mr-2"></i> Ver
          Vista Pública</a>

        <!-- Contenedor Flex para Importar y Exportar con diseño apilado -->
        <div class="flex items-stretch gap-2">
          <!-- Botón de Importar con icono y texto apilados -->
          <button id="btnImportar"
            class="btn btn-secondary flex-1 flex flex-col items-center justify-center p-2 text-xs h-auto rounded-xl">
            <i class="fas fa-file-import text-lg mb-1"></i>
            <span>Importar</span>
          </button>

          <!-- Botón de Exportar (con menú) con icono y texto apilados -->
          <div id="export-menu-container" class="relative flex-1">
            <button id="btnToggleExport"
              class="btn btn-secondary w-full h-full flex flex-col items-center justify-center p-2 text-xs rounded-xl">
              <i class="fas fa-file-export text-lg mb-1"></i>
              <div class="flex items-center">
                <span>Exportar</span>
                <i class="fas fa-chevron-up ml-1 text-base"></i>
              </div>
            </button>
            <div id="export-options"
              class="hidden absolute bottom-full mb-2 w-full bg-[#242424] rounded-lg shadow-lg border border-gray-600 z-10">
              <a href="#" id="btnExportarJSON"
                class="block px-4 py-3 text-sm text-gray-200 hover:bg-gray-600 rounded-t-lg">Exportar a JSON</a>
              <a href="#" id="btnPublicarWeb" class="block px-4 py-3 text-sm text-gray-200 hover:bg-gray-600">Publicar
                (Web)</a>
              <a href="#" id="btnExportarPDF" class="block px-4 py-3 text-sm text-gray-200 hover:bg-gray-600">Exportar a
                PDF</a>
              <a href="#" id="btnExportarKDP"
                class="block px-4 py-3 text-sm text-gray-200 hover:bg-gray-600 rounded-b-lg">Exportar para KDP
                (HTML)</a>
            </div>
          </div>
        </div>
      </div>
    </aside>

    <!-- Main Content -->
    <main class="flex-grow flex flex-col overflow-y-auto relative z-10">
      <div id="welcomeScreen" class="flex-grow flex flex-col items-center justify-center text-center">
        <h2 class="text-4xl font-bold mb-4">¡Bienvenido!</h2>
        <p class="text-gray-400 mb-6">Comienza un nuevo proyecto o selecciona uno existente para empezar a diseñar tu
          historia.</p>
        <button id="btnCrearInicial" class="btn btn-primary">Crear Nuevo Proyecto</button>
      </div>

      <div id="projectScreen" class="hidden flex-grow flex flex-col p-4 md:p-8">
        <header
          class="flex flex-col md:flex-row md:justify-between md:items-center gap-4 relative z-20 p-4 md:p-6 sticky top-0 bg-black/50 backdrop-blur-md border-b border-white/5">
          <div class="flex items-center space-x-4 flex-wrap">
            <h2 id="nombreProyecto" class="text-3xl md:text-4xl font-bold text-white"></h2>
            <button id="btnEditarNombre" title="Editar nombre del proyecto"
              class="text-[#00e9fa] hover:text-[#00d4e0]"><i class="fas fa-edit"></i></button>
            <button id="btnEliminarProyecto" title="Eliminar proyecto" class="text-red-500 hover:text-red-400"><i
                class="fas fa-trash-alt"></i></button>
            <!-- Selector de idioma -->
            <div class="flex items-center gap-2 ml-4">
              <i class="fas fa-language text-[#00e9fa]"></i>
              <select id="languageSelector"
                class="bg-[#242424] text-white border border-gray-600 rounded px-3 py-1 text-sm focus:outline-none focus:border-[#00e9fa]">
                <option value="es">Español</option>
                <option value="en">English</option>
              </select>
            </div>
          </div>
          <div class="relative w-full md:w-auto">
            <!-- Botón para el dropdown en móvil -->
            <button id="tabs-toggle"
              class="md:hidden w-full flex justify-between items-center p-3 bg-black border border-white/10 rounded-sm text-white hover:border-primary/50 transition-all">
              <span id="current-tab-name">Dashboard</span>
              <i class="fas fa-chevron-down ml-2 transition-transform" id="tabs-toggle-icon"></i>
            </button>
            <!-- Navegación de pestañas -->
            <nav id="tabs-nav"
              class="hidden md:flex flex-col md:flex-row md:space-x-0 md:p-0 bg-black border border-white/10 rounded-sm md:rounded-sm relative md:relative w-full md:w-auto mt-2 md:mt-0 z-50 absolute md:static top-14 md:top-auto left-0 md:left-auto right-0 md:right-auto md:w-auto max-h-[60vh] md:max-h-none overflow-y-auto md:overflow-y-visible">
              <button type="button" data-tab="dashboard"
                class="tab-button active w-full text-left md:text-center py-3 px-4 text-sm font-medium text-primary border-b-2 md:border-b-0 md:border-r border-white/5 hover:bg-white/5 transition-all"><i
                  class="fas fa-chart-line mr-1"></i>Dashboard</button>
              <button type="button" data-tab="chapters"
                class="tab-button w-full text-left md:text-center py-3 px-4 text-sm font-medium text-white/70 border-b-2 md:border-b-0 md:border-r border-white/5 hover:text-primary hover:bg-white/5 transition-all"><i
                  class="fas fa-book mr-1"></i>Capítulos</button>
              <button type="button" data-tab="characters"
                class="tab-button w-full text-left md:text-center py-3 px-4 text-sm font-medium text-white/70 border-b-2 md:border-b-0 md:border-r border-white/5 hover:text-primary hover:bg-white/5 transition-all"><i
                  class="fas fa-users mr-1"></i>Personajes</button>
              <button type="button" data-tab="places"
                class="tab-button w-full text-left md:text-center py-3 px-4 text-sm font-medium text-white/70 border-b-2 md:border-b-0 md:border-r border-white/5 hover:text-primary hover:bg-white/5 transition-all"><i
                  class="fas fa-map-marker-alt mr-1"></i>Lugares</button>
              <button type="button" data-tab="objects"
                class="tab-button w-full text-left md:text-center py-3 px-4 text-sm font-medium text-white/70 border-b-2 md:border-b-0 md:border-r border-white/5 hover:text-primary hover:bg-white/5 transition-all"><i
                  class="fas fa-box mr-1"></i>Objetos</button>
              <button type="button" data-tab="mindmap"
                class="tab-button w-full text-left md:text-center py-3 px-4 text-sm font-medium text-white/70 border-b-2 md:border-b-0 md:border-r border-white/5 hover:text-primary hover:bg-white/5 transition-all"><i
                  class="fas fa-project-diagram mr-1"></i>Mapa Mental</button>
              <button type="button" data-tab="comments"
                class="tab-button w-full text-left md:text-center py-3 px-4 text-sm font-medium text-white/70 border-b-2 md:border-b-0 md:border-r border-white/5 hover:text-primary hover:bg-white/5 transition-all"><i
                  class="fas fa-comments mr-1"></i>Comentarios</button>
              <button type="button" data-tab="ratings"
                class="tab-button w-full text-left md:text-center py-3 px-4 text-sm font-medium text-white/70 border-b-2 md:border-b-0 border-white/5 hover:text-primary hover:bg-white/5 transition-all"><i
                  class="fas fa-star-half-alt mr-1"></i>Calificaciones</button>
            </nav>
          </div>
        </header>

        <!-- Dashboard -->
        <div id="tab-dashboard" class="tab-content active overflow-y-auto">

          <h3 class="text-2xl font-bold mb-6">Resumen del Proyecto</h3>

          <!-- Portada del Proyecto y botón de IA -->
          <div class="mb-6">
            <div class="card relative group cursor-pointer" id="projectCoverWrapper">
              <img id="projectCoverImage" src="" alt="Portada del Proyecto" loading="lazy"
                class="w-full h-64 object-cover rounded-lg hidden">
              <div id="projectCoverPlaceholder"
                class="w-full h-64 bg-[#242424] border-2 border-dashed border-gray-600 rounded-lg flex items-center justify-center">
                <div class="text-center text-gray-500">
                  <i class="fas fa-image text-5xl mb-2"></i>
                  <p>Añade una portada para tu proyecto</p>
                </div>
              </div>
              <div
                class="absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity rounded-lg">
                <span class="text-white text-lg"><i class="fas fa-edit mr-2"></i>Cambiar Portada</span>
              </div>
              <input type="file" id="inputProjectCover" class="hidden" accept="image/*">
            </div>
            <button type="button" id="btnOpenCoverGenerator"
              class="btn btn-primary mt-4 w-full flex items-center justify-center">
              <i class="fas fa-paint-brush mr-2"></i>
              <span>Gestionar Portada con IA</span>
            </button>
          </div>

          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6">
            <div class="card p-6 flex flex-col items-center justify-center"><i
                class="fas fa-book text-4xl text-[#00e9fa] mb-2"></i>
              <p>Total de Capítulos</p>
              <p id="totalChapters" class="text-5xl font-extrabold">0</p>
            </div>
            <div class="card p-6 flex flex-col items-center justify-center"><i
                class="fas fa-users text-4xl text-[#00e9fa] mb-2"></i>
              <p>Total de Personajes</p>
              <p id="totalCharacters" class="text-5xl font-extrabold">0</p>
            </div>
            <div class="card p-6 flex flex-col items-center justify-center"><i
                class="fas fa-map-marker-alt text-4xl text-[#00e9fa] mb-2"></i>
              <p>Total de Lugares</p>
              <p id="totalPlaces" class="text-5xl font-extrabold">0</p>
            </div>
            <div class="card p-6 flex flex-col items-center justify-center"><i
                class="fas fa-box text-4xl text-[#00e9fa] mb-2"></i>
              <p>Total de Objetos</p>
              <p id="totalObjects" class="text-5xl font-extrabold">0</p>
            </div>
            <div class="card p-6 flex flex-col items-center justify-center"><i
                class="fas fa-images text-4xl text-[#00e9fa] mb-2"></i>
              <p>Total de Imágenes</p>
              <p id="totalImages" class="text-5xl font-extrabold">0</p>
            </div>
          </div>

          <div class="mt-8">
            <h3 class="text-2xl font-bold mb-4">Galería Rápida</h3>
            <div id="quickGallery" class="grid grid-cols-2 sm:grid-cols-4 md:grid-cols-6 lg:grid-cols-8 gap-4">
              <!-- Las imágenes se insertarán aquí con JS -->
            </div>
          </div>

          <!-- Elementos Destacados -->
          <div class="mt-8">
            <h3 class="text-2xl font-bold mb-6">Elementos Destacados</h3>

            <h4 class="text-xl font-semibold mb-4 text-[#00e9fa]">Personajes Aleatorios</h4>
            <div id="featuredCharactersContainer" data-type="character"
              class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-4 mb-8">
              <!-- JS poblará esto -->
            </div>

            <h4 class="text-xl font-semibold mb-4 text-green-400">Lugares Aleatorios</h4>
            <div id="featuredPlacesContainer" data-type="place"
              class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-4 mb-8">
              <!-- JS poblará esto -->
            </div>

            <h4 class="text-xl font-semibold mb-4 text-[#00e9fa]">Objetos Aleatorios</h4>
            <div id="featuredObjectsContainer" data-type="object"
              class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-4 mb-8">
              <!-- JS poblará esto -->
            </div>
          </div>

          <!-- Análisis del Proyecto -->
          <div class="mt-8">
            <h3 class="text-2xl font-bold mb-6">Análisis del Proyecto</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
              <div id="characterAgeChartContainer" class="card p-6">
                <h4 class="text-xl font-semibold mb-4 text-[#00e9fa]">Demografía de Personajes (Edad)</h4>
                <div class="relative h-96"><canvas id="characterAgeChart"></canvas></div>
              </div>
              <div id="characterGenderChartContainer" class="card p-6">
                <h4 class="text-xl font-semibold mb-4 text-teal-400">Demografía de Personajes (Género)</h4>
                <div class="relative h-96"><canvas id="characterGenderChart"></canvas></div>
              </div>
              <div id="placeTypeChartContainer" class="card p-6">
                <h4 class="text-xl font-semibold mb-4 text-cyan-400">Distribución de Lugares (Tipo)</h4>
                <div class="relative h-96"><canvas id="placeTypeChart"></canvas></div>
              </div>
              <div id="objectTypeChartContainer" class="card p-6">
                <h4 class="text-xl font-semibold mb-4 text-[#00e9fa]">Distribución de Objetos (Tipo)</h4>
                <div class="relative h-96"><canvas id="objectTypeChart"></canvas></div>
              </div>
              <!-- NUEVO: Análisis de Calificaciones -->
              <div id="ratingAnalysisContainer" class="card p-6 md:col-span-2 lg:col-span-3 hidden">
                <h4 class="text-xl font-semibold mb-4 text-[#00e9fa]">Análisis de Calificaciones Promedio</h4>
                <div class="relative h-96"><canvas id="ratingAnalysisChart"></canvas></div>
              </div>
            </div>
          </div>

        </div>

        <!-- Capítulos -->
        <div id="tab-chapters" class="tab-content overflow-y-auto relative">
          <div class="mb-6">
            <h3 class="text-2xl font-bold">Capítulos</h3>
          </div>
          <div id="chaptersList" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6 pb-20">
          </div>
          <button id="btnAddChapter"
            class="fab-button hidden fixed bottom-8 right-8 w-16 h-16 bg-[#00e9fa] hover:bg-[#00d4e0] text-black rounded-full shadow-lg flex items-center justify-center transition-all hover:scale-110 z-50"
            title="Añadir Capítulo">
            <i class="fas fa-plus text-2xl"></i>
          </button>
        </div>

        <!-- Personajes -->
        <div id="tab-characters" class="tab-content overflow-y-auto relative">
          <div class="mb-6">
            <h3 class="text-2xl font-bold">Personajes</h3>
          </div>
          <div id="charactersList" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6 pb-20">
          </div>
          <button id="btnAddCharacter"
            class="fab-button hidden fixed bottom-8 right-8 w-16 h-16 bg-[#00e9fa] hover:bg-[#00d4e0] text-black rounded-full shadow-lg flex items-center justify-center transition-all hover:scale-110 z-50"
            title="Añadir Personaje">
            <i class="fas fa-plus text-2xl"></i>
          </button>
        </div>



        <!-- Lugares -->
        <div id="tab-places" class="tab-content overflow-y-auto relative">
          <div class="mb-6">
            <h3 class="text-2xl font-bold">Lugares</h3>
          </div>
          <div id="placesList" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6 pb-20"></div>
          <button id="btnAddPlace"
            class="fab-button hidden fixed bottom-8 right-8 w-16 h-16 bg-[#00e9fa] hover:bg-[#00d4e0] text-black rounded-full shadow-lg flex items-center justify-center transition-all hover:scale-110 z-50"
            title="Añadir Lugar">
            <i class="fas fa-plus text-2xl"></i>
          </button>
        </div>

        <!-- Objetos -->
        <div id="tab-objects" class="tab-content overflow-y-auto relative">
          <div class="mb-6">
            <h3 class="text-2xl font-bold">Objetos</h3>
          </div>
          <div id="objectsList" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6 pb-20"></div>
          <button id="btnAddObject"
            class="fab-button hidden fixed bottom-8 right-8 w-16 h-16 bg-[#00e9fa] hover:bg-[#00d4e0] text-black rounded-full shadow-lg flex items-center justify-center transition-all hover:scale-110 z-50"
            title="Añadir Objeto">
            <i class="fas fa-plus text-2xl"></i>
          </button>
        </div>

        <!-- Mapa Mental -->
        <div id="tab-mindmap" class="tab-content relative min-h-0">
          <!-- FIX: min-h-0 es crucial para el layout de flexbox anidado y evita la expansión infinita -->
          <div id="mindmap-toolbar" class="p-4 bg-[#1A1A1A] border-b border-gray-700 flex flex-wrap items-center gap-4">
            <button id="btnGenerateMindMap" class="btn btn-primary">
              <i class="fas fa-cogs mr-2"></i>Generar desde Contenido
            </button>
            <button id="btnLinkNodes" class="btn btn-secondary">
              <i class="fas fa-link mr-2"></i>Enlazar Nodos
            </button>
            <button id="btnPhysicsConfig" class="btn btn-secondary">
              <i class="fas fa-atom mr-2"></i>Ajustar Físicas
            </button>
            <span class="text-gray-400 text-sm"></span>
          </div>
          <!-- Leyenda del Mapa Mental -->
          <div id="mindmap-legend"
            class="p-2 bg-[#1A1A1A] border-b border-gray-700 flex items-center justify-center gap-x-6 gap-y-2 flex-wrap text-gray-300">
            <!-- La leyenda se generará aquí con JS -->
          </div>
          <div id="mindMapContainer" class="w-full h-[80vh] border border-gray-700 rounded-lg bg-[#1A1A1A]"></div>
        </div>

        <!-- Gestión de Comentarios -->
        <div id="tab-comments" class="tab-content overflow-y-auto">
          <div class="flex justify-between items-center mb-6">
            <h3 class="text-2xl font-bold">Gestión de Comentarios</h3>
            <!-- Podríamos añadir filtros o un botón de recarga aquí en el futuro -->
          </div>
          <div id="commentsManagementList" class="space-y-4">
            <div id="no-comments-message" class="text-center py-12 text-gray-500 hidden">
              <i class="fas fa-comment-slash text-4xl mb-4"></i>
              <p>Aún no hay comentarios para este proyecto.</p>
            </div>
          </div>
        </div>

        <!-- Gestión de Calificaciones -->
        <div id="tab-ratings" class="tab-content overflow-y-auto">
          <div class="flex justify-between items-center mb-6">
            <h3 class="text-2xl font-bold">Gestión de Calificaciones</h3>
          </div>
          <div id="ratingsManagementList" class="space-y-4">
            <div id="no-ratings-message" class="text-center py-12 text-gray-500 hidden">
              <i class="fas fa-star-slash text-4xl mb-4"></i>
              <p>Aún no hay calificaciones para este proyecto.</p>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div> <!-- Fin de #app-container -->

  <!-- Modal genérico -->
  <div id="genericModal" class="modal-overlay">
    <div class="modal">
      <div class="modal-header">
        <h3 id="modalTitle" class="text-2xl font-bold"></h3>
      </div>
      <div class="modal-body">
        <form id="genericForm" class="space-y-4">
          <!-- Campo nombre -->
          <div class="flex flex-col">
            <label for="inputName" class="mb-2 font-semibold">Nombre</label>
            <input type="text" id="inputName" required class="w-full">
          </div>

          <!-- Campo nombre en inglés -->
          <div class="flex flex-col">
            <label for="inputNameEn" class="mb-2 font-semibold text-gray-400">Nombre en Inglés <span
                class="text-xs">(opcional)</span></label>
            <input type="text" id="inputNameEn" class="w-full">
          </div>

          <!-- Campos de Capítulo Agrupados -->
          <div class="chapter-field hidden p-4 bg-[#242424] rounded-lg border border-gray-700 space-y-4">
            <h4 class="text-lg font-semibold text-[#00e9fa] border-b border-gray-600 pb-2">Detalles del Capítulo</h4>
            <div class="flex flex-col">
              <label for="inputOrder" class="mb-2 font-semibold">Número de Orden</label>
              <input type="number" id="inputOrder" class="w-full" placeholder="Ej: 1" min="0">
            </div>
          </div>

          <!-- Campos de Personaje Agrupados -->
          <div class="character-field hidden p-4 bg-[#242424] rounded-lg border border-gray-700 space-y-4">
            <h4 class="text-lg font-semibold text-[#00e9fa] border-b border-gray-600 pb-2">Detalles del Personaje</h4>
            <!-- Campos Edad y Altura -->
            <div class="grid grid-cols-2 gap-4">
              <div class="flex flex-col">
                <label for="inputAge" class="mb-2 font-semibold">Edad</label>
                <input type="text" id="inputAge" class="w-full">
              </div>
              <div class="flex flex-col">
                <label for="inputHeight" class="mb-2 font-semibold">Altura</label>
                <input type="text" id="inputHeight" class="w-full">
              </div>
            </div>

            <!-- Campo Género -->
            <div class="flex flex-col">
              <label for="inputGender" class="mb-2 font-semibold">Género</label>
              <select id="inputGender"
                class="w-full bg-[#242424] color-[#E0E0E0] border border-gray-600 rounded-lg p-3 focus:outline-none focus:border-[#00e9fa] focus:ring-2 focus:ring-[#00e9fa]/50">
                <option value="no-especificado">No especificado</option>
                <option value="femenino">Femenino</option>
                <option value="masculino">Masculino</option>
                <option value="androgino">Andrógino</option>
                <option value="no-binario">No Binario</option>
                <option value="otro">Otro</option>
              </select>
            </div>

            <!-- Campo Descripción Física -->
            <div class="flex flex-col">
              <label for="inputPhysicalDescription" class="mb-2 font-semibold">Descripción Física</label>
              <textarea id="inputPhysicalDescription" rows="3" class="w-full"></textarea>
            </div>

            <!-- Campo Historia -->
            <div class="flex flex-col">
              <label for="inputBackstory" class="mb-2 font-semibold">Historia / Trasfondo</label>
              <textarea id="inputBackstory" rows="5" class="w-full"></textarea>
            </div>
          </div>

          <!-- Campos de Lugar Agrupados -->
          <div class="place-field hidden p-4 bg-[#242424] rounded-lg border border-gray-700 space-y-4">
            <h4 class="text-lg font-semibold text-[#00e9fa] border-b border-gray-600 pb-2">Detalles del Lugar</h4>
            <!-- Campo Tipo de Lugar -->
            <div class="flex flex-col">
              <label for="inputPlaceType" class="mb-2 font-semibold">Tipo de Lugar</label>
              <select id="inputPlaceType"
                class="w-full bg-[#242424] color-[#E0E0E0] border border-gray-600 rounded-lg p-3 focus:outline-none focus:border-[#00e9fa] focus:ring-2 focus:ring-[#00e9fa]/50">
                <option value="no-especificado">No especificado</option>
                <option value="terrenal">Terrenal</option>
                <option value="espacial">Espacial</option>
                <option value="astral">Astral</option>
                <option value="urbano">Urbano</option>
                <option value="rural">Rural</option>
                <option value="ficticio">Ficticio</option>
                <option value="historico">Histórico</option>
              </select>
            </div>
            <!-- Campo Atmósfera -->
            <div class="flex flex-col">
              <label for="inputAtmosphere" class="mb-2 font-semibold">Atmósfera / Ambiente</label>
              <textarea id="inputAtmosphere" rows="3" class="w-full"></textarea>
            </div>
            <!-- Campo Características Clave -->
            <div class="flex flex-col">
              <label for="inputKeyFeatures" class="mb-2 font-semibold">Características Clave</label>
              <textarea id="inputKeyFeatures" rows="3" class="w-full"
                placeholder="Ej: Un antiguo altar de piedra, un río de lava, árboles que susurran..."></textarea>
            </div>
            <!-- Campo Historia / Lore -->
            <div class="flex flex-col">
              <label for="inputPlaceLore" class="mb-2 font-semibold">Historia / Lore</label>
              <textarea id="inputPlaceLore" rows="5" class="w-full"></textarea>
            </div>
            <!-- Campo Mapa del Lugar -->
            <div class="flex flex-col">
              <label for="inputPlaceMap" class="mb-2 font-semibold">Mapa del Lugar</label>
              <div class="flex items-start gap-4">
                <div class="flex-grow">
                  <input type="file" id="inputPlaceMap" accept="image/*" class="w-full">
                  <!-- Campo para seleccionar el servicio de IA para mapas -->
                  <div id="mapServiceField" class="hidden mt-2">
                    <label for="inputMapService" class="block text-sm font-medium text-gray-300 mb-1">Servicio de IA
                      para Mapas</label>
                    <select id="inputMapService"
                      class="w-full bg-[#242424] border border-gray-600 rounded-lg px-3 py-2 focus:ring-[#00e9fa] focus:border-[#00e9fa]">
                      <option value="pollinations">Pollinations.ai (Rápido, variado)</option>
                      <option value="stablediffusion">Stable Diffusion (Detallado)</option>
                    </select>
                  </div>
                  <!-- Campo para seleccionar el estilo del mapa -->
                  <div id="mapStyleField" class="hidden mt-2">
                    <label for="inputMapStyle" class="block text-sm font-medium text-gray-300 mb-1">Estilo de
                      Mapa</label>
                    <select id="inputMapStyle"
                      class="w-full bg-[#242424] border border-gray-600 rounded-lg px-3 py-2 focus:ring-[#00e9fa] focus:border-[#00e9fa]">
                      <option value="satellite">Satélite Realista</option>
                      <option value="fantasy">Fantasía (Dibujado a mano)</option>
                      <option value="blueprint">Plano / Blueprint</option>
                      <option value="ancient">Pergamino Antiguo</option>
                      <option value="cyberpunk">Cyberpunk / Neón</option>
                    </select>
                  </div>
                  <button type="button" id="btnGenerateMap"
                    class="btn btn-secondary text-sm mt-2 w-full flex items-center justify-center">
                    <i class="fas fa-magic mr-2"></i>
                    <span id="btnGenerateMapText">Generar Mapa con IA</span>
                    <i id="mapSpinner" class="fas fa-spinner fa-spin ml-2 hidden"></i>
                  </button>
                </div>
                <div class="relative w-32 h-32 flex-shrink-0">
                  <div id="mapPreview"
                    class="w-full h-full bg-[#242424] border border-gray-600 rounded-lg flex items-center justify-center text-gray-500 overflow-hidden">
                    <i class="fas fa-map text-3xl"></i>
                  </div>
                  <button type="button" id="btnDeleteMapImage" title="Eliminar imagen del mapa"
                    class="absolute top-1 right-1 w-6 h-6 bg-red-600/80 hover:bg-red-700 text-white rounded-full flex items-center justify-center text-xs hidden transition-opacity z-10">
                    <i class="fas fa-times"></i>
                  </button>
                </div>
              </div>
            </div>

            <!-- Gestión de Imágenes -->
            <div id="imageSwapContainer" class="p-3 bg-gray-900/50 rounded-lg border border-gray-700 mt-4">
              <h5 class="text-md font-semibold text-[#00e9fa] mb-3 text-center">Gestión de Imágenes</h5>
              <div class="flex justify-center items-center gap-4">
                <div class="text-center">
                  <p class="text-sm text-gray-400">Imagen Principal</p>
                  <i class="fas fa-image text-2xl my-2"></i>
                </div>
                <div class="flex flex-col gap-2">
                  <button type="button" id="btnUseMapAsMain" title="Usar mapa como imagen principal"
                    class="w-12 h-10 bg-[#00e9fa] hover:bg-[#00d4e0] rounded-lg text-black flex items-center justify-center transition-transform hover:scale-110"><i
                      class="fas fa-arrow-left"></i></button>
                  <button type="button" id="btnUseMainAsMap" title="Usar imagen principal como mapa"
                    class="w-12 h-10 bg-[#00e9fa] hover:bg-[#00d4e0] rounded-lg text-black flex items-center justify-center transition-transform hover:scale-110"><i
                      class="fas fa-arrow-right"></i></button>
                </div>
                <div class="text-center">
                  <p class="text-sm text-gray-400">Mapa del Lugar</p>
                  <i class="fas fa-map text-2xl my-2"></i>
                </div>
              </div>
              <p class="text-xs text-gray-500 text-center mt-2">Usa estos botones para copiar una imagen de un campo a
                otro.</p>
            </div>
          </div>

          <!-- Campos de Objeto Agrupados -->
          <div class="object-field hidden p-4 bg-[#242424] rounded-lg border border-gray-700 space-y-4">
            <h4 class="text-lg font-semibold text-[#00e9fa] border-b border-gray-600 pb-2">Detalles del Objeto</h4>
            <!-- Campo Tipo/Categoría -->
            <div class="flex flex-col">
              <label for="inputObjectType" class="mb-2 font-semibold">Tipo / Categoría</label>
              <select id="inputObjectType"
                class="w-full bg-[#242424] color-[#E0E0E0] border border-gray-600 rounded-lg p-3 focus:outline-none focus:border-[#00e9fa] focus:ring-2 focus:ring-[#00e9fa]/50">
                <option value="no-especificado">No especificado</option>
                <option value="arma">Arma</option>
                <option value="reliquia">Reliquia</option>
                <option value="herramienta">Herramienta</option>
                <option value="consumible">Consumible</option>
                <option value="documento">Documento</option>
                <option value="otro">Otro</option>
              </select>
            </div>
            <!-- Campo Origen -->
            <div class="flex flex-col">
              <label for="inputObjectOrigin" class="mb-2 font-semibold">Origen / Fabricación</label>
              <textarea id="inputObjectOrigin" rows="3" class="w-full"></textarea>
            </div>
            <!-- Campo Poderes/Habilidades -->
            <div class="flex flex-col">
              <label for="inputObjectPowers" class="mb-2 font-semibold">Poderes / Habilidades</label>
              <textarea id="inputObjectPowers" rows="3" class="w-full"></textarea>
            </div>
            <!-- Campo Relevancia en la Trama -->
            <div class="flex flex-col">
              <label for="inputObjectRelevance" class="mb-2 font-semibold">Relevancia en la Trama</label>
              <textarea id="inputObjectRelevance" rows="4" class="w-full"></textarea>
            </div>
          </div>

          <!-- Campo descripción general -->
          <div class="flex flex-col">
            <label for="inputDescription" class="mb-2 font-semibold">Descripción General / Personalidad</label>
            <textarea id="inputDescription" rows="4" class="w-full"></textarea>
          </div>

          <!-- Campo descripción en inglés -->
          <div class="flex flex-col">
            <label for="inputDescriptionEn" class="mb-2 font-semibold text-gray-400">Descripción en Inglés <span
                class="text-xs">(opcional)</span></label>
            <textarea id="inputDescriptionEn" rows="4" class="w-full"></textarea>
          </div>

          <!-- Campo imagen -->
          <div class="flex flex-col">
            <label for="inputImage" class="mb-2 font-semibold">Imagen</label>
            <div class="flex items-start gap-4">
              <div class="flex-grow">
                <input type="file" id="inputImage" accept="image/*" class="w-full">
                <!-- Campo para seleccionar el servicio de IA -->
                <div id="imageServiceField" class="hidden mt-2">
                  <label for="inputImageService" class="block text-sm font-medium text-gray-300 mb-1">Servicio de
                    IA</label>
                  <select id="inputImageService"
                    class="w-full bg-[#242424] border border-gray-600 rounded-lg px-3 py-2 focus:ring-[#00e9fa] focus:border-[#00e9fa]">
                    <option value="pollinations">Pollinations.ai (Rápido, variado)</option>
                    <option value="stablediffusion">Stable Diffusion (Detallado)</option>
                  </select>
                </div>
                <!-- Campo para seleccionar el estilo de la imagen principal -->
                <div id="imageStyleField" class="hidden mt-2">
                  <label for="inputImageStyle" class="block text-sm font-medium text-gray-300 mb-1">Estilo de
                    Imagen</label>
                  <select id="inputImageStyle"
                    class="w-full bg-[#242424] border border-gray-600 rounded-lg px-3 py-2 focus:ring-[#00e9fa] focus:border-[#00e9fa]">
                    <option value="default">Por Defecto (Fantasía)</option>
                    <option value="futuristic">Futurista / Sci-Fi</option>
                    <option value="modern">Moderno / Realista</option>
                    <option value="vintage">Vintage / Pasado</option>
                    <option value="dynamic">Dinámico / Acción</option>
                    <option value="surreal">Surrealista / Abstracto</option>
                    <option value="minimalist">Minimalista</option>
                    <option value="biological">Biológico / Orgánico</option>
                    <option value="chemical">Químico / Abstracto</option>
                    <option value="steampunk">Steampunk</option>
                    <option value="blueprint">Plano / Blueprint</option>
                  </select>
                </div>
                <button type="button" id="btnGenerateImage"
                  class="btn btn-secondary text-sm mt-2 w-full flex items-center justify-center">
                  <i class="fas fa-magic mr-2"></i>
                  <span id="btnGenerateImageText">Generar Imagen con IA</span>
                  <i id="imageSpinner" class="fas fa-spinner fa-spin ml-2 hidden"></i>
                </button>
              </div>
              <div class="relative w-32 h-32 flex-shrink-0">
                <div id="imagePreview"
                  class="w-full h-full bg-[#242424] border border-gray-600 rounded-lg flex items-center justify-center text-gray-500 overflow-hidden">
                  <i class="fas fa-image text-3xl"></i>
                </div>
                <button type="button" id="btnDeleteImage" title="Eliminar imagen"
                  class="absolute top-1 right-1 w-6 h-6 bg-red-600/80 hover:bg-red-700 text-white rounded-full flex items-center justify-center text-xs hidden transition-opacity z-10">
                  <i class="fas fa-times"></i>
                </button>
              </div>
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <!-- Botones -->
        <div class="flex justify-end space-x-4">
          <button type="button" id="btnCancel" class="btn btn-secondary">Cancelar</button>
          <button type="submit" form="genericForm" id="btnSave" class="btn btn-primary">Guardar</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal de Gestión de Administradores -->
  <div id="adminManagementModal" class="modal-overlay" style="display: none;">
    <div class="modal max-w-4xl">
      <div class="modal-header">
        <h3 class="text-2xl font-bold">Gestión de Administradores</h3>
      </div>
      <div class="modal-body">

        <!-- Tabs -->
        <div class="flex border-b border-gray-700 mb-6">
          <button id="tab-list-admins" class="px-4 py-2 font-semibold text-primary border-b-2 border-primary">
            Lista de Administradores
          </button>
          <button id="tab-create-admin" class="px-4 py-2 font-semibold text-gray-400 hover:text-primary">
            Crear Administrador
          </button>
        </div>

        <!-- Panel: Lista de Administradores -->
        <div id="panel-list-admins" class="space-y-4">
          <div class="flex justify-between items-center mb-4">
            <p class="text-gray-400">Administradores registrados en el sistema</p>
            <button id="btn-refresh-admins" class="btn btn-secondary text-xs">
              <i class="fas fa-sync-alt mr-1"></i> Actualizar
            </button>
          </div>

          <div id="admins-list-container" class="space-y-2 max-h-96 overflow-y-auto">
            <div class="text-center py-8 text-gray-400">
              <i class="fas fa-spinner fa-spin text-3xl mb-2"></i>
              <p>Cargando administradores...</p>
            </div>
          </div>
        </div>

        <!-- Panel: Crear Administrador -->
        <div id="panel-create-admin" class="hidden">
          <div class="bg-yellow-500/10 border border-yellow-500 text-yellow-400 px-4 py-3 rounded-md mb-6">
            <p class="text-sm">
              <i class="fas fa-lock mr-2"></i>
              <strong>Autenticación requerida:</strong> Debes ingresar tu contraseña actual para crear un nuevo
              administrador.
            </p>
          </div>

          <form id="create-admin-form" class="space-y-4">
            <!-- Autenticación del admin actual -->
            <div class="bg-gray-800/50 p-4 rounded-lg space-y-4 border border-gray-700">
              <h4 class="font-semibold text-gray-300">Tu Autenticación</h4>

              <div>
                <label for="current-admin-email" class="block text-sm font-medium text-gray-300 mb-2">
                  Tu Correo
                </label>
                <input type="email" id="current-admin-email" required
                  class="w-full px-4 py-2 bg-white/5 border border-white/10 text-white rounded-md focus:ring-2 focus:ring-primary focus:border-primary"
                  placeholder="admin@xlerion.com">
              </div>

              <div>
                <label for="current-admin-password" class="block text-sm font-medium text-gray-300 mb-2">
                  Tu Contraseña Actual
                </label>
                <input type="password" id="current-admin-password" required
                  class="w-full px-4 py-2 bg-white/5 border border-white/10 text-white rounded-md focus:ring-2 focus:ring-primary focus:border-primary"
                  placeholder="••••••••">
              </div>
            </div>

            <!-- Datos del nuevo administrador -->
            <div class="bg-gray-800/50 p-4 rounded-lg space-y-4 border border-gray-700">
              <h4 class="font-semibold text-gray-300">Nuevo Administrador</h4>

              <div>
                <label for="new-admin-name" class="block text-sm font-medium text-gray-300 mb-2">
                  Nombre Completo
                </label>
                <input type="text" id="new-admin-name" required
                  class="w-full px-4 py-2 bg-white/5 border border-white/10 text-white rounded-md focus:ring-2 focus:ring-primary focus:border-primary"
                  placeholder="Juan Pérez">
              </div>

              <div>
                <label for="new-admin-email" class="block text-sm font-medium text-gray-300 mb-2">
                  Correo Electrónico
                </label>
                <input type="email" id="new-admin-email" required
                  class="w-full px-4 py-2 bg-white/5 border border-white/10 text-white rounded-md focus:ring-2 focus:ring-primary focus:border-primary"
                  placeholder="nuevo@xlerion.com">
              </div>

              <div>
                <label for="new-admin-password" class="block text-sm font-medium text-gray-300 mb-2">
                  Contraseña (mínimo 8 caracteres)
                </label>
                <input type="password" id="new-admin-password" required minlength="8"
                  class="w-full px-4 py-2 bg-white/5 border border-white/10 text-white rounded-md focus:ring-2 focus:ring-primary focus:border-primary"
                  placeholder="••••••••">
                <p class="text-xs text-gray-400 mt-1">
                  Usa mayúsculas, minúsculas, números y símbolos para mayor seguridad
                </p>
              </div>

              <div>
                <label for="new-admin-password-confirm" class="block text-sm font-medium text-gray-300 mb-2">
                  Confirmar Contraseña
                </label>
                <input type="password" id="new-admin-password-confirm" required minlength="8"
                  class="w-full px-4 py-2 bg-white/5 border border-white/10 text-white rounded-md focus:ring-2 focus:ring-primary focus:border-primary"
                  placeholder="••••••••">
              </div>
            </div>

            <!-- Mensajes -->
            <div id="create-admin-error"
              class="hidden bg-red-500/10 border border-red-500 text-red-400 px-4 py-3 rounded-md text-sm"></div>
            <div id="create-admin-success"
              class="hidden bg-green-500/10 border border-green-500 text-green-400 px-4 py-3 rounded-md text-sm"></div>

            <!-- Botones -->
            <div class="flex justify-end space-x-4 pt-4">
              <button type="button" id="btn-cancel-create-admin" class="btn btn-secondary">
                Cancelar
              </button>
              <button type="submit" class="btn btn-primary">
                <i class="fas fa-user-plus mr-2"></i>
                Crear Administrador
              </button>
            </div>
          </form>
        </div>

      </div>
      <div class="modal-footer">
        <button type="button" id="btn-close-admin-modal" class="btn btn-secondary">Cerrar</button>
      </div>
    </div>
  </div>

  <!-- Modal para Generar Portada -->
  <div id="coverGeneratorModal" class="modal-overlay">
    <div class="modal">
      <div class="modal-header">
        <h3 class="text-2xl font-bold">Gestionar Portada del Proyecto</h3>
      </div>
      <div class="modal-body">
        <form id="coverGeneratorForm" class="space-y-6">
          <!-- Descripción Larga / Sinopsis -->
          <div>
            <label for="projectSummary" class="block text-xl font-semibold mb-2 text-[#00e9fa]">Resumen del Proyecto /
              Sinopsis</label>
            <p class="text-sm text-gray-400 mb-4">Escribe aquí un resumen de tu historia. Este texto se usará para las
              exportaciones y para generar la portada con IA.</p>
            <textarea id="projectSummary" rows="6"
              class="w-full bg-[#242424] border border-gray-600 rounded-lg p-3 focus:outline-none focus:border-[#00e9fa] focus:ring-2 focus:ring-[#00e9fa]/50"
              placeholder="Ej: En un mundo post-apocalíptico, dos héroes viajan en el tiempo para..."></textarea>
          </div>
          <!-- Campo para seleccionar el servicio de IA para portadas -->
          <div>
            <label for="coverImageService" class="block text-sm font-medium text-gray-300 mb-1">Servicio de IA para
              Portada</label>
            <select id="coverImageService"
              class="w-full bg-[#242424] border border-gray-600 rounded-lg px-3 py-2 focus:ring-[#00e9fa] focus:border-[#00e9fa]">
              <option value="pollinations">Pollinations.ai (Rápido, variado)</option>
              <option value="stablediffusion">Stable Diffusion (Detallado)</option>
            </select>
          </div>

          <!-- Campo para seleccionar el estilo de la portada -->
          <div>
            <label for="coverImageStyle" class="block text-sm font-medium text-gray-300 mb-1">Estilo de Portada</label>
            <select id="coverImageStyle"
              class="w-full bg-[#242424] border border-gray-600 rounded-lg px-3 py-2 focus:ring-[#00e9fa] focus:border-[#00e9fa]">
              <option value="default">Por Defecto (Fantasía)</option>
              <option value="futuristic">Futurista / Sci-Fi</option>
              <option value="modern">Moderno / Realista</option>
              <option value="vintage">Vintage / Pasado</option>
              <option value="surreal">Surrealista / Abstracto</option>
              <option value="minimalist">Minimalista</option>
              <option value="steampunk">Steampunk</option>
              <option value="blueprint">Plano / Blueprint</option>
            </select>
          </div>

          <!-- Preview de la portada actual -->
          <div>
            <label class="block text-sm font-medium text-gray-300 mb-1">Portada Actual</label>
            <div id="coverPreviewInModal"
              class="w-full h-48 bg-[#242424] border border-gray-600 rounded-lg flex items-center justify-center text-gray-500 overflow-hidden">
              <i class="fas fa-image text-4xl"></i>
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <div class="flex justify-end space-x-4">
          <button type="button" id="btnCancelCoverGeneration" class="btn btn-secondary">Cancelar</button>
          <button type="button" id="btnGenerateProjectCover" class="btn btn-primary flex items-center justify-center"><i
              class="fas fa-magic mr-2"></i><span id="btnGenerateProjectCoverText">Generar Nueva Portada</span><i
              id="projectCoverSpinner" class="fas fa-spinner fa-spin ml-2 hidden"></i></button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal de detalles -->
  <div id="detailsModal" class="modal-overlay">
    <div class="modal">
      <div class="modal-header">
        <div id="detailsImageContainer" class="w-full h-64 rounded-lg overflow-hidden mb-4 hidden">
          <img id="detailsImage" class="w-full h-full object-cover" src="" alt="" loading="lazy">
        </div>
        <h3 id="detailsTitle" class="text-3xl font-bold mb-2"></h3>
        <!-- Contenedor para detalles de personaje -->
        <div id="characterDetailsInfo" class="hidden flex flex-wrap gap-x-6 gap-y-2 text-gray-400 mb-4">
          <div id="detailsAgeContainer" class="hidden">
            <span class="font-semibold text-[#00e9fa]">Edad:</span>
            <span id="detailsAge"></span>
          </div>
          <div id="detailsHeightContainer" class="hidden">
            <span class="font-semibold text-[#00e9fa]">Altura:</span>
            <span id="detailsHeight"></span>
          </div>
          <div id="detailsGenderContainer" class="hidden">
            <span class="font-semibold text-[#00e9fa]">Género:</span>
            <span id="detailsGender"></span>
          </div>
        </div>
      </div>
      <div class="modal-body">
        <!-- Contenedor para detalles de lugar -->
        <div id="placeDetailsInfo" class="hidden mb-6 space-y-6">
          <div id="detailsPlaceTypeContainer" class="hidden">
            <h4 class="font-bold text-xl mb-2 text-[#00e9fa]">Tipo de Lugar</h4>
            <p id="detailsPlaceType" class="text-gray-300 whitespace-pre-wrap"></p>
          </div>
          <div id="detailsAtmosphereContainer" class="hidden">
            <h4 class="font-bold text-xl mb-2 text-[#00e9fa]">Atmósfera / Ambiente</h4>
            <p id="detailsAtmosphere" class="text-gray-300 whitespace-pre-wrap"></p>
          </div>
          <div id="detailsKeyFeaturesContainer" class="hidden">
            <h4 class="font-bold text-xl mb-2 text-[#00e9fa]">Características Clave</h4>
            <p id="detailsKeyFeatures" class="text-gray-300 whitespace-pre-wrap"></p>
          </div>
          <div id="detailsPlaceLoreContainer" class="hidden">
            <h4 class="font-bold text-xl mb-2 text-[#00e9fa]">Historia / Lore</h4>
            <p id="detailsPlaceLore" class="text-gray-300 whitespace-pre-wrap"></p>
          </div>
        </div>

        <!-- Contenedor para el mapa del lugar -->
        <div id="detailsMapContainer" class="hidden mt-6">
          <h4 class="font-bold text-xl mb-2 text-[#00e9fa]">Mapa del Lugar</h4>
          <div class="w-full bg-gray-800 p-2 rounded-lg border border-gray-700">
            <img id="detailsMap" class="w-full h-auto object-contain rounded-md" src="" alt="Mapa del Lugar"
              loading="lazy">
          </div>
        </div>

        <!-- Contenedor para detalles de objeto -->
        <div id="objectDetailsInfo" class="hidden mb-6 space-y-6">
          <div id="detailsObjectTypeContainer" class="hidden">
            <h4 class="font-bold text-xl mb-2 text-[#00e9fa]">Tipo / Categoría</h4>
            <p id="detailsObjectType" class="text-gray-300 whitespace-pre-wrap"></p>
          </div>
          <div id="detailsObjectOriginContainer" class="hidden">
            <h4 class="font-bold text-xl mb-2 text-[#00e9fa]">Origen / Fabricación</h4>
            <p id="detailsObjectOrigin" class="text-gray-300 whitespace-pre-wrap"></p>
          </div>
          <div id="detailsObjectPowersContainer" class="hidden">
            <h4 class="font-bold text-xl mb-2 text-[#00e9fa]">Poderes / Habilidades</h4>
            <p id="detailsObjectPowers" class="text-gray-300 whitespace-pre-wrap"></p>
          </div>
          <div id="detailsObjectRelevanceContainer" class="hidden">
            <h4 class="font-bold text-xl mb-2 text-[#00e9fa]">Relevancia en la Trama</h4>
            <p id="detailsObjectRelevance" class="text-gray-300 whitespace-pre-wrap"></p>
          </div>
        </div>

        <!-- Contenedor para descripción física -->
        <div id="detailsPhysicalDescriptionContainer" class="hidden mb-6">
          <h4 class="font-bold text-xl mb-2 text-[#00e9fa]">Descripción Física</h4>
          <p id="detailsPhysicalDescription" class="text-gray-300 whitespace-pre-wrap"></p>
        </div>
        <!-- Contenedor para descripción general -->
        <div id="detailsDescriptionContainer" class="mb-6">
          <h4 id="detailsDescriptionHeader" class="font-bold text-xl mb-2 text-[#00e9fa]">Descripción General /
            Personalidad</h4>
          <p id="detailsDescription" class="text-gray-300 whitespace-pre-wrap"></p>
        </div>
        <!-- Contenedor para la historia -->
        <div id="detailsBackstoryContainer" class="hidden mt-6">
          <h4 class="font-bold text-xl mb-2 text-[#00e9fa]">Historia / Trasfondo</h4>
          <p id="detailsBackstory" class="text-gray-300 whitespace-pre-wrap"></p>
        </div>
      </div>
      <div class="modal-footer flex justify-end space-x-4">
        <button type="button" id="btnEditDetails" class="btn btn-primary"><i
            class="fas fa-edit mr-2"></i>Editar</button>
        <button type="button" id="btnDeleteDetails" class="btn btn-secondary"><i
            class="fas fa-trash-alt mr-2"></i>Eliminar</button>
        <button type="button" id="btnCloseDetails" class="btn btn-secondary">Cerrar</button>
      </div>
    </div>
  </div>

  <!-- Script -->
  <!-- Cargar los datos de ejemplo para que la app pueda inicializar la base de datos -->
  <!-- DEBE cargarse ANTES de app.js -->
  <script src="data.js"></script>
  <!-- Auth configuration (required for admin login) -->
  <script src="auth-config.js"></script>
  <!-- Firebase SDKs -->
  <!-- Firebase eliminado: autenticación local habilitada -->
  <script src="app.js?v=20260112-security" type="module"></script>

  <!-- Gestión de Administradores con Backend -->
  <script src="admin-management.js"></script>
</body>

</html>